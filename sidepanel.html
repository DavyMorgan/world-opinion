<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>World Opinion</title>
  <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
  <div class="container">
    <div id="mainContent">
      <div class="button-row">
        <button id="analyzeBtn" class="btn btn-primary btn-large">
          üåç See How World Says
        </button>
        <button id="refreshBtn" class="refresh-icon-btn hidden" title="Refresh analysis">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
            <path d="M21 3v5h-5"/>
            <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
            <path d="M3 21v-5h5"/>
          </svg>
        </button>
      </div>

      <div id="loading" class="loading hidden">
        <div id="screenshotPreview" class="screenshot-preview hidden">
          <img id="screenshotImg" alt="Page being analyzed">
        </div>
        <div class="progress-milestones">
          <div class="milestone" data-stage="chrome">
            <div class="milestone-icon">
              <img src="icons/chrome.png" alt="Chrome">
            </div>
            <span class="milestone-label">Extract</span>
          </div>
          <div class="milestone-connector"></div>
          <div class="milestone" data-stage="gemini">
            <div class="milestone-icon">
              <img src="icons/gemini.png" alt="Gemini">
            </div>
            <span class="milestone-label">Analyze</span>
          </div>
          <div class="milestone-connector"></div>
          <div class="milestone" data-stage="polymarket">
            <div class="milestone-icon">
              <img src="icons/polymarket.png" alt="Polymarket">
            </div>
            <span class="milestone-label">Search</span>
          </div>
          <div class="milestone-connector"></div>
          <div class="milestone" data-stage="filter">
            <div class="milestone-icon">
              <img src="icons/gemini.png" alt="Gemini">
            </div>
            <span class="milestone-label">Filter</span>
          </div>
        </div>
        <p id="progressText">Extracting page content...</p>
      </div>

      <div id="fallbackNotice" class="fallback-notice hidden"></div>

      <div id="results" class="results hidden">
        <div id="analysis" class="section">
          <h3>Content Analysis</h3>
          <p id="analysisText"></p>
        </div>

        <div id="keywords" class="section hidden">
          <h3>Keywords</h3>
          <div id="keywordsList" class="tags-container"></div>
        </div>

        <div id="markets" class="section">
          <div id="marketsList"></div>
        </div>
      </div>

      <div id="error" class="error hidden"></div>
    </div>

    <footer>
      <button id="settingsBtn" class="settings-icon-btn" title="Settings">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
      </button>
    </footer>

    <div id="settingsPanel" class="settings-panel hidden">
      <h3>Model Configuration</h3>
      <div class="input-group model-group">
        <label for="geminiModel">Model:</label>
        <select id="geminiModel" class="model-select">
          <option value="gemini-nano" id="nanoOption" class="hidden">Gemini Nano (on device)</option>
          <option value="gemini-3-pro-preview">Gemini 3 Pro</option>
          <option value="gemini-3-flash-preview" selected>Gemini 3 Flash</option>
          <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
          <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
          <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite</option>
        </select>
      </div>
      <div class="input-group" id="apiKeyGroup">
        <div class="label-row">
          <label for="geminiKey">Gemini API Key:</label>
          <a href="https://aistudio.google.com/api-keys" target="_blank" class="api-key-help">Don't have an API Key? Create one!</a>
        </div>
        <div class="input-with-action">
          <input type="password" id="geminiKey" placeholder="Enter your Gemini API key">
          <button id="saveSettings" class="save-icon-btn" title="Save">
            <svg class="icon-save" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
              <polyline points="17 21 17 13 7 13 7 21"></polyline>
              <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            <svg class="icon-check hidden" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          </button>
        </div>
      </div>
      <div class="setting-row">
        <label for="showAnalysis">Show Content Analysis and Keywords</label>
        <label class="toggle-switch">
          <input type="checkbox" id="showAnalysis">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <p id="privacyNote" class="privacy-note">Your data goes directly to Gemini ‚Äî we never see what you analyze.</p>
    </div>
  </div>

  <!-- Modular JavaScript (order matters for dependencies) -->
  <script src="js/config.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/state.js"></script>
  <script src="js/cache.js"></script>
  <script src="js/api-gemini.js"></script>
  <script src="js/api-polymarket.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
